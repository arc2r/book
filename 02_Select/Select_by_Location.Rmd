## Select by Location

```{r,echo=FALSE}
knitr::opts_chunk$set(warning = F, message = F, tidy = T)
library(dplyr)
library(sf)
library(ggplot2)
```
One of the most commonly used operations in ArcGIS pro is the process of selecting features of a spatial object (layer) based on whether or not these relate spatially to another object (layer). This process is also referred as __spatial subsetting__. In ArcGIS pro this can be performed in various ways using the `Select by Location tool`. 

In __R__ the same operation is, on a first level, performed using the `square bracket ([])` operator from the base R package.

An example of spatial subsetting could be the following. Let's assume we have as a shapefile (polygon dataframe) with all the municipalities (Gemeinde) of the Canton of Zurich. Furthermore, we are also using a shapefile in the form of a point dataframe, which represents all the __"swimming spots"__ (Badenpl√§tze) in the same spatial region (Canton of Zurich). So, ultimately, our goal is to find out the __"swimming spots"__ that lie within a specific municipality of the Canton of Zurich. 


```{r echo=T}
# Minicipalities (Gemeinde) in Canton Zurich
gemeinde_ZH <- st_read("sample_data/Kanton_Zuerich/Gemeinde_ZH.shp")

# "Swimming" spots in the Canton of Zurich
swimmSpots <- st_read("sample_data/Kanton_Zuerich/Badeplaetze_ZH.shp")
```

```{r, echo=F}
# Municipality (Gemeinde) of Richterswil 
richterswil <- dplyr::filter(gemeinde_ZH, gemeindena == "Richterswil")
names(richterswil)[5] = "Municipality"

ggplot() + geom_sf(data = gemeinde_ZH) + geom_sf(data = richterswil,aes(fill = Municipality)) + geom_sf(data = swimmSpots,color = "blue") + ggtitle("Swimming spots in the Canton of Zurich") + theme_minimal()
```

After importing and depicting the __"swimming spots"__ throughout the canton of Zurich, let's assume we want to check if and how many of them __lie within__ the Municipality of Richterswil. To do so, we will perform an operation, which belongs to the category of __Spatial subsetting__.

```{r}
swimmSpots_richt <- swimmSpots[richterswil, ,op = st_within]
```

```{r,echo=F}
ggplot() + geom_sf(data = gemeinde_ZH) + geom_sf(data = swimmSpots,color = "blue") + geom_sf(data = richterswil, fill = "white") + geom_sf(data = swimmSpots_richt, color = "red") + ggtitle("Swimming spots in the Canton of Zurich") + theme_minimal() 
```

The operation above is based on the following rule: `x[y, ,operation]`, where:  

<style>

div.note { background-color:#f0f0f0; border-radius: 5px; padding: 20px;}
</style>
<div class = "note">

-  __x__ and __y__ are the spatial objects for which we want to investigate if there is a spatial relationship (x is the target feature, while y is the source one)  
-  the second argument __[, ,]__ within the brackets denotes the column number we want to retrieve from the spatial subsetting. In our example this argument was empty, which means we wanted to retrieve all rows for every __attribute column__.  
-  the third argument __[op = ]__ specifies the spatial operation we want to perform. In the example above, the goal was to find out how many subset features of the target object _swimmSpots_ lie withing the source spatial object _richterswil_. For that reason we chose the function __st_within()__.

</div>

Depending on what we want to examine, we choose the respective function.

