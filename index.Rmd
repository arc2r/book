---
title: "All things R Spatial"
subtitle: "arc2r: An introduction to spatial-R for recovering ArcGIS users"
author: "Nils Ratnaweera and Nikolaos Bakogiannis"
date: "`r format(Sys.time(), '%d %B, %Y')`"
site: bookdown::bookdown_site
bibliography:
  - bibliography/general.bib
  - bibliography/packages.bib
nocite: '@*'
---


```{r,echo=FALSE,message=FALSE,warning=FALSE}
library(tidyverse)
library(yaml)

now <- Sys.time()
tz <- Sys.timezone()
```

[![Actions Status](https://github.com/arc2r/book/workflows/bookdown/badge.svg)](https://github.com/arc2r/book/actions)


# Welcome!

## What this book is about

This is a resource for people wanting to learn spatial-R (Analysis, Visualization) in R and are coming with a background in ArcGIS. This resource should provide some help on this journey. To make use of this ressource, we assume two things: (1) that you have some prior experience with `R` and (2) that you have experience with Geodata and GIS-Concepts. 

This book leans heavily on how the Toolboxes and Toolsets are organized in ArcGIS Pro. The idea is that you can look up specific things of which you only know the ArcGIS terminology for. This book is a work in progress, and *we highly appreciate contributions* to this book: If you have anything to add, please [file an issue or make a pull request](https://github.com/arc2r/book).  

We are big fans of using `magrittr`'s pipe function `%>%` and heavily use it throughout this book. In addition for vector data, we use packages from the `tidyverse` (especially from the `dplyr` package: filter()`, `mutate()` and `summarise()`).

## How it started

We had long since thought about the necessity of a resource which helps ArcGIS users transition to R or Python. Nils had tweeted about this (see below) without getting much reception, and and one point just decided to start his own resource. Since [our research group](gis.lsfm.zhaw.ch/) teaches and introduction to GIS and an advanced GIS course mostly based on ArcGIS, we decided to pick up where Nils hat started and develop the resource in with internal funding of our University. 




```{r,echo=FALSE, fig.cap="[Nils' Tweet](https://twitter.com/NRatnaweera/status/1187759876472213504) might not have received much attention, but it did spark a conversation within our group", out.width="70%", fig.align="center"}
knitr::include_graphics("images/tweet1.jpg")
```

## What might make your journey difficult {#difficulties}

What are the main difficulties when switching from ArcGIS to `R`? 

- The fundamental building block of ArcGIS is a visual representation of your data (i.e. the map). The fundamental building block in `R` is your RScript. The visual aspect makes ArcGIS more approachable, but also less scalable.
- When you acquire ArcGIS, you are served from a single source. In `R`, there are a plethora of developers creating packages for you to use, which can be quite overwhelming
- While there are always multiple ways to solve a problem in ArcGIS, there are usually many more ways to solve it in `R`
- When you transition from a proprietary Software like ArcGIS to [FOSS](https://en.wikipedia.org/wiki/Free_and_open-source_software), you have to relearn many of the concepts because the proprietary software usually does not adhere to common standards.
- ArcGIS follows the concept of creating a tool for *every* situation you might encounter. With this approach, they provide a selection of > 1'000 geoprocessing tools to your disposal. Generally speaking, the authors of Packages will try to keep the number of functions as small as possible, since this reduces maintenance.
<!--
//todo add this somewhere
//body when you add a shapefile to your arcgis project, you basically have a "connection" to this file. in R, you create a virtual copy / an R representation of your dataset within your r session
-->

## Why you should transition anyway

We strongly advocate the use of a programming language to tackle GIS tasks for the following reasons:

<!--
# todo translate this
#  add specific advantages of using FOSS?
#  Ich Programmieren, weil ich damit:
#  1. … repetitive Tasks automatisieren kann
#  2. … übertragbare «Tools» bauen kann
#  3. … mehr Flexibilität und «Power» habe
#  4. … zu Grunde liegende Funktionen besser verstehe
#  5. … bessere Möglichkeiten habe zu Kollaborieren
#  6. … bessere Möglichkeiten habe, Hilfe zu erhalten
#  7.… reproduzierbar arbeite
--> 


## How to use this book


<!--
# todo(ratnanil) add instructions on how to use the book
  # on the `arc2r` package and the coding environment
--> 


```{r}

library(formattable)
library(kableExtra)


tools_todo <- read_yaml("auxiliary/tools_todo.yaml")

tools_todo_df <- imap_dfr(tools_todo, function(toolbox,toolboxname){
  imap_dfr(toolbox, function(toolset,toolsetname){
    imap_dfr(toolset, function(toolprogress, toolname){
      toolprogress <- as.character(toolprogress)
      tibble(tool = toolname, progress = toolprogress)
    }) %>%
      mutate(toolset = toolsetname)
  }) %>%
    mutate(toolbox = toolboxname)
}) %>% 
  mutate(
    progress = na_if(progress,"NA"),
    progress = as.integer(progress)
  )



tools_todo_df <- tools_todo_df %>%
  mutate(
    progress = round(runif(nrow(.),0,100),0)
  )

tools_todo_df <- tools_todo_df %>%
  # mutate(toolset = paste(toolbox,toolset)) %>%
  group_by(toolbox) %>%
  mutate(toolbox_progress = mean(progress)) %>%
  group_by(toolbox,toolset) %>%
  mutate(toolset_progress = mean(progress)) %>%
  arrange(
    desc(toolbox_progress),
    toolbox,
    desc(toolset_progress),
    toolset,
    desc(progress),
    ) %>%
  ungroup()

pack_rows_helper <- function(vec) {
  rle_out <- rle(vec)
  map2(rle_out$values,rle_out$lengths, function(x,y){
    names(y) <- x
    y
  }) %>%
    unlist()
}

tools_todo_df %>%
  dplyr::transmute(Tool = tool,Progress = progress) %>%
  mutate(
    Progress = color_bar("lightblue")(Progress)
    ) %>%
  kable("html",escape = FALSE) %>%
  kable_styling() %>%
  pack_rows(index = pack_rows_helper(tools_todo_df$toolbox),background = "darkgrey") %>%
  pack_rows(index = pack_rows_helper(tools_todo_df$toolset),
            bold = FALSE,italic = TRUE,background = "lightgrey")






```




