# Image Analysis Toolbox

<!-- ## Map Algebra Toolset -->


### Raster Calulator

In GIS Softwares (ArcGIS pro, QGIS etc) `Raster Calculator` is one of the most
commonly used tools for performing various operations with raster datasets.  
Let's explore our options for performing similar tasks with R.  

```{r}
library(raster)
pop_2000 <- raster("sample_data/population_raster/gpw_v4_population_count_rev11_2000_2pt5_min.tif")
pop_2010 <- raster("sample_data/population_raster/gpw_v4_population_count_rev11_2010_2pt5_min.tif")

par(mfrow=c(1,2))
plot(pop_2000)
plot(pop_2010)

```

<!-- ## Math Toolset -->

<!-- ## Overlay Toolset -->

<!-- ### Weighted Sum -->

<!-- ## Statistical Toolset -->

<!-- ### Cell Statistics -->

### Focal Statistics

>`Focal statistics` performs a neighbourhood operation that computes an output raster, where the value for each output cell is a function of the values of all the input cells that are in a specified neighborhood around that location. The function performed on the input is a statistic, such as the maximum, average, or sum of all values encountered in that neighborhood.
Source: https://pro.arcgis.com/en/pro-app/latest/tool-reference/spatial-analyst/how-focal-statistics-works.html

In R in order to apply functions focally to rasters, important is to define the neighbouring cells.
In other words to define the moving window for each of these functions. As an example below,
we will create our own raster object.  

```{r}
library(raster)

r <- raster(ncol=10, nrow=10)
values(r) <- 1:ncell(r)
plot(r, main='Raster with 100 cells', cex.main = 1)
``` 

We will recompute now the raster based on the _focal_ function of the  __raster__ package. In the function
below, the neighbourhood for which we apply the statistic is represented by the argument *w*, while the 
statistic by the argument *fun*. 

```{r} 
f1 <- focal(r, w=matrix(1,nrow=3,ncol=3),fun=sum)
plot(f1, main = "Raster after applying the focal function - raster package", cex.main = 1)
```

The operation above can be also performed with the use of the _focal_ function of the __terra__ package.  

  - *w* represents the moving window of the function. The window can be defined as one (for a square)
    or two numbers (row, col); or with an odd-sized weights matrix. More details can be found here: https://rdrr.io/cran/terra/man/focal.html
  - *fun* represents the specified statistic for the identified neighbourhood (e.g mean,sum etc)
  
```{r}
library(terra)
r_spat <- as(r, "SpatRaster")
f2 <- terra::focal(r_spat,w=3,fun = "sum")
plot(f2, main = "Raster after applying the focal function - terra package", cex.main = 1)
```

### Zonal Statistics

`Zonal Statistics` tool in ArcGIS pro is used for calculating the statistics
on values of a raster within the zones of another dataset. In R we are able to produce
similar results with the use of _zonal_ function of the __raster__ package. 
x
```{r}
r <- raster(ncols=10, nrows=10)
# generating random numbers that will used as values in our raster layer (r) - input values raster
values(r) <- runif(ncell(r)) * 1:ncell(r)

z <- r
# generating integer values for the raster layer z, which will be used as the zone raster
values(z) <- rep(1:5, each=20) 

# Zonal statistics - Summarize
zonal(r, z, "sum")

# Zonal statistics - Mean
zonal(r, z, "mean")

# Zonal statistics - Minimum
zonal(r, z, "min")
```



