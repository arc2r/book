
## Extract Toolset {#extract-toolset}

For this chapter, you will need the following R Packages:
```{r, echo=FALSE}
library(arc2r)
library(sf)
library(tmap)
```

### Clip

Quite often in spatial analysis, we come across with cases, where we do not want to use all the available data there is. In other words, we want to focus on a specific area of interest, which dictates the need for __clipping__ the existing dataset based on it's relationship to some other existing spatial feature. In R this operation can be easily performed using the `st_intersection` function in `sf`.
  
Let's assume in the example below that we want to clip the available dataset of all the __train stations in Switzerland__ by focusing our analysis on four specific cantons.


<!--
/ todo: replcace this with arc2r/arc2r
/  assignees: KimboGilda
--> 

```{r}

# Point dataset depicting the train stations locations across Switzerland
data("haltestelle_bahn")

# Dataset depicting Switzerland on canton level
data("kantonsgebiet")

tmap_mode(mode = "plot") # setting the plotting mode to static -- optimizing the process

tm_shape(kantonsgebiet) + tm_polygons("#f0f0f0") + 
  tm_shape(haltestelle_bahn) + tm_dots(col = "#e34a33",size = 0.1, alpha = 0.5) + 
  tm_shape(kantonsgebiet) + tm_borders(col = "black") + tm_layout(frame = F)
   
```

As it was mentioned above, the aim is to analyse the situation at a particular area. So we are going to create an index with the specific cantons we are interested in.


```{r}
index <- kantonsgebiet$name == "ZÃ¼rich" |
  kantonsgebiet$name == "St. Gallen" |
  kantonsgebiet$name == "Thurgau" |
  kantonsgebiet$name == "Aargau"

# Selecting the cantons based on the previously generated index
kantons_aOi <- kantonsgebiet[index,]

# Performing the clipping operation
hal_clipped <- st_intersection(kantons_aOi,haltestelle_bahn)
```

 - Plotting the result from the clipping operation
```{r}
tm_shape(kantons_aOi) + tm_polygons("#f0f0f0") + 
  tm_shape(hal_clipped) + tm_dots(col = "#e34a33",size = 0.1, alpha = 0.5) + 
  tm_shape(kantons_aOi) + tm_borders() + tm_layout(frame = F)
```

So, ultimately, as we can see above, the `st_intersection` function creates a result where the point dataset is precisely "clipped" based on the area of interest


The operation above produces the same outcome as the one depicted in the figure below \@ref(fig:clip).

```{r clip, fig.cap= "Clip operation in ArcGIS pro",echo=F, out.width = "750px",fig.align='center'}
knitr::include_graphics("images/clipOperation.png")
```

